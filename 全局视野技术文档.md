# 全局视野技术文档

- 部分函数析构函数不全
- 抽象类有没有必要保存现在的构造函数重载
- Solve类需要修改，太多接口暴露在外
- param类怎么写？全是public

## 软件设计

### 系统架构

全局视野主要由四部分组成：

- 执行/交互
- 算法
- 通信
- 参数

（绘制UML图）

### 运行流程

### 重点功能



## 算法设计

### 功能介绍&pipeline



### 重点算法阐释

### 算法性能，优缺点阐述，优化方案

### 介绍与接口说明

#### ThreadController

```cpp
void ThreadController::run();//开启全局视野进程，注册全局视野回调函数，并开启交互线程
```

#### Communicator

通讯类

```cpp
Communicator(std::shared_ptr<ThreadWatcher> mSendTestLoopWatcherPtr,
                 std::shared_ptr<ThreadWatcher> mReceiveTestLoopWatcherPtr);//构造函数

    void sendTestLoop();//发送循环

    void receiveLoop();//接受循环
```





#### TasK

##### TaskBase

相机任务抽象类

```cpp
Task(std::shared_ptr<ThreadWatcher> _TaskCallBackWatchPtr);//神经网络任务类构造函数
Task(std::shared_ptr<Detector> _DetectorPtr,std::shared_ptr <ThreadWatcher> _TaskCallBackWatchPtr);//传统视觉任务类构造函数
    virtual ~Task(){};//析构函数
    virtual void TaskCallBack(const hitcrt::camera::TimePoint &_timeStamp,const cv::Mat &_frameImage)=0; //相机任务类回调函数对应的纯虚函数接口
    Task(Task const&)=delete;
    Task& operator=(Task const&)=delete;

    std::shared_ptr<CamSloveParam> m_Cam_Param= nullptr;//相机坐标解算参数
    std::shared_ptr<FPSParam> m_FPS_Param = nullptr;//FPS显示参数
```

##### TaskNN

相机任务神经网络类

```cpp
TaskNN(std::shared_ptr<Detector> _DetectorPtr,std::shared_ptr <ThreadWatcher> _TaskCallBackWatchPtr);//构造函数

 virtual void TaskCallBack(const hitcrt::camera::TimePoint &_timeStamp,
                              const cv::Mat &_frameImage);
//回调函数

```

##### TaskCV

相机任务传统视觉类

```cpp
 TaskCV(std::shared_ptr <ThreadWatcher> _TaskCallBackWatchPtr);//构造函数
 virtual void TaskCallBack(const hitcrt::camera::TimePoint &_timeStamp,const cv::Mat &_frameImage);//回调函数

```

#### Detect

装甲板识别类

```cpp
Detect();//默认构造函数
bool runArmorDetect(const Frame& frame, cv::Rect2i roiRect,
                        cv::Point2i roiOrigin,
                        std::vector<armorPlate> &armorPlates);
//装甲板识别
```

#### Associate

轨迹匹配类

```cpp
    Associate();//默认构造函数

    ~Associate() = default;//默认析构函数

    void runArmorAssociate(std::vector<armorPlate> _armors, bool ifxtl,
                           int &_id, int cxflag);//轨迹匹配
    std::vector<Trajectory> m_trajectories;  ///轨迹存储

```

#### Solver



坐标解算与变换类

```


```

#### Param

参数类

```cpp
void param::loadParam();//加载参数
```









### 算法结果

